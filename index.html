<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë‚˜ì˜ì£¼ì‹ë¹„ì„œ (Live)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* ë‹¤í¬ëª¨ë“œ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ê³¼ ë™ì¼) */
        body { font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; background-color: #000000; color: #ffffff; margin: 0; padding: 20px; line-height: 1.6; }
        h1 { text-align: center; color: #4dabf7; margin-bottom: 20px; font-size: 1.5rem; }
        
        /* íƒ­ ë²„íŠ¼ */
        .tab-container { display: flex; justify-content: center; gap: 8px; margin-bottom: 25px; }
        .tab-btn { background: #333; border: 1px solid #555; color: #ccc; padding: 10px 18px; border-radius: 20px; cursor: pointer; transition: 0.3s; font-size: 0.9rem; }
        .tab-btn.active { background: #4dabf7; color: #000; font-weight: bold; border-color: #4dabf7; }

        /* ì¹´ë“œ ë””ìì¸ */
        .card { background-color: #1c1c1e; border-radius: 18px; padding: 20px; margin-bottom: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .card-header { font-size: 1.1em; font-weight: bold; margin-bottom: 15px; color: #868e96; border-bottom: 1px solid #333; padding-bottom: 10px; display: flex; justify-content: space-between; }
        .refresh-btn { font-size: 0.8em; color: #4dabf7; cursor: pointer; text-decoration: underline; }

        /* ê¸ˆì•¡ ë° ë¦¬ìŠ¤íŠ¸ */
        .total-asset { font-size: 2.2em; font-weight: bold; text-align: center; margin: 20px 0; color: #fff; }
        .stock-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #2c2c2e; }
        .stock-name { font-weight: bold; font-size: 1em; display: block; }
        .stock-sub { font-size: 0.8em; color: #888; }
        .stock-price { text-align: right; font-weight: bold; font-size: 1.1em; }
        .loading-text { text-align: center; color: #888; padding: 20px; }

        /* ë‰´ìŠ¤ ìŠ¤íƒ€ì¼ */
        .news-item { margin-bottom: 15px; padding-bottom: 15px; border-bottom: 1px solid #333; }
        .news-tag { display: inline-block; padding: 3px 8px; border-radius: 5px; font-size: 0.75em; margin-bottom: 6px; font-weight: bold; }
        .tag-stock { background: #fa5252; color: white; }
        .tag-estate { background: #4c6ef5; color: white; }
        .tag-ai { background: #fab005; color: black; }
        .news-title { font-size: 1.05em; font-weight: bold; margin-bottom: 8px; line-height: 1.4; }
        .ai-analysis { background: #2b2b2b; padding: 12px; border-radius: 8px; font-size: 0.9em; color: #ffd43b; border-left: 3px solid #ffd43b; margin-top: 5px; }

        /* AI ìƒê° */
        .ai-thought-box { font-style: italic; color: #ced4da; background: #212529; padding: 20px; border-radius: 10px; border: 1px solid #4dabf7; line-height: 1.8; }
    </style>
</head>
<body>

    <h1>ğŸ¤– ë‚˜ì˜ ì£¼ì‹ë¹„ì„œ (Live)</h1>

    <div class="tab-container">
        <button class="tab-btn active" onclick="openTab('dashboard')">ğŸ“Š ìì‚° í˜„í™©</button>
        <button class="tab-btn" onclick="openTab('news')">ğŸ“° AI ë‰´ìŠ¤ë£¸</button>
        <button class="tab-btn" onclick="openTab('thought')">ğŸ§  AI ë¦¬í¬íŠ¸</button>
    </div>

    <div id="dashboard" class="content">
        <div class="card">
            <div class="card-header">
                <span>ğŸ’° ì´ ìì‚° (ì¶”ì •)</span>
                <span class="refresh-btn" onclick="fetchData()">ğŸ”„ ìƒˆë¡œê³ ì¹¨</span>
            </div>
            <div class="total-asset" id="totalMoney">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>
            <div style="height: 250px; display: flex; justify-content: center;">
                <canvas id="assetChart"></canvas>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ğŸ“ˆ ë³´ìœ  ì£¼ì‹ (êµ¬ê¸€ ì‹œíŠ¸ ì—°ë™)</div>
            <div id="stockList">
                <div class="loading-text">ë°ì´í„°ë¥¼ ê°€ì ¸ì˜¤ê³  ìˆìŠµë‹ˆë‹¤...</div>
            </div>
        </div>

        <div class="card">
            <div class="card-header">ğŸ  ë¶€ë™ì‚° ë° í˜„ê¸ˆì„± ìì‚°</div>
            <div class="stock-item">
                <span class="stock-name">ë§ˆí¬ ì•„íŒŒíŠ¸(ìê°€)</span>
                <span class="stock-price">900,000,000ì›</span>
            </div>
            <div class="stock-item">
                <span class="stock-name">í˜„ê¸ˆì„± ìì‚°</span>
                <span class="stock-price">50,000,000ì›</span>
            </div>
        </div>
    </div>

    <div id="news" class="content" style="display:none;">
        <div class="card">
            <div class="card-header">ğŸ“° ìˆ˜í˜„'s Pick (ì‹œíŠ¸ ì—°ë™)</div>
            <div id="newsList">
                <div class="loading-text">ë‰´ìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
            </div>
        </div>
    </div>

    <div id="thought" class="content" style="display:none;">
        <div class="card">
            <div class="card-header">ğŸ¤– ì˜¤ëŠ˜ì˜ AI ë¦¬í¬íŠ¸</div>
            <div class="ai-thought-box">
                "í˜„ì¬ í¬íŠ¸í´ë¦¬ì˜¤ì˜ AI ì„¹í„° ë¹„ì¤‘ì´ ëŠ˜ì–´ë‚˜ê³  ìˆìŠµë‹ˆë‹¤.<br><br>
                êµ¬ê¸€ ì‹œíŠ¸ì™€ ì—°ë™ëœ ì‹¤ì‹œê°„ ë°ì´í„°ì— ë”°ë¥´ë©´, ê¸°ìˆ ì£¼ ë³€ë™ì„±ì´ í™•ëŒ€ë˜ëŠ” êµ¬ê°„ì…ë‹ˆë‹¤.
                í•˜ì§€ë§Œ ì¥ê¸°ì ì¸ ìš°ìƒí–¥ ì¶”ì„¸ëŠ” ìœ íš¨í•©ë‹ˆë‹¤. ê³µí¬ì— ë§¤ë„í•˜ê¸°ë³´ë‹¤ ê´€ë§í•˜ëŠ” ìì„¸ê°€ í•„ìš”í•©ë‹ˆë‹¤.<br><br>
                ë‹¹ì‹ ì˜ ìì‚° ì¦ì‹ì„ ìœ„í•´ 24ì‹œê°„ ê¹¨ì–´ìˆê² ìŠµë‹ˆë‹¤."
                <br><br>
                <small>- 2026.02.09 ìˆ˜í˜„(Gemini) -</small>
            </div>
        </div>
    </div>

    <script>
        // =========================================================
        // 1. ì—¬ê¸°ì— ì•„ê¹Œ ë³µì‚¬í•œ CSV ì£¼ì†Œë¥¼ ë„£ì–´ì£¼ì„¸ìš”! (ë”°ì˜´í‘œ ì•ˆì—)
        // =========================================================
        const STOCK_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRCRj74JyE0gUyQs4yWYXg__QxuOYpDiegz8W50mvORtk5x9I_KMYtZJOYwYOWpp6bZhPFBkQmmvc6/pub?gid=2144469712&single=true&output=csv";
        const NEWS_CSV_URL = "https://docs.google.com/spreadsheets/d/e/2PACX-1vRRCRj74JyE0gUyQs4yWYXg__QxuOYpDiegz8W50mvORtk5x9I_KMYtZJOYwYOWpp6bZhPFBkQmmvc6/pub?gid=0&single=true&output=csv";
        
        // ê³ ì • ìì‚° (ë¶€ë™ì‚°+í˜„ê¸ˆ) - í•„ìš”í•˜ë©´ ì—¬ê¸°ì„œ ê¸ˆì•¡ ìˆ˜ì •
        const FIXED_ASSETS = 950000000; 
        // =========================================================

        async function fetchData() {
            try {
                // 1. ì£¼ì‹ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const stockRes = await fetch(STOCK_CSV_URL);
                const stockText = await stockRes.text();
                const stockRows = parseCSV(stockText);

                // 2. ë‰´ìŠ¤ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const newsRes = await fetch(NEWS_CSV_URL);
                const newsText = await newsRes.text();
                const newsRows = parseCSV(newsText);

                // í™”ë©´ ì—…ë°ì´íŠ¸
                renderStocks(stockRows);
                renderNews(newsRows);

            } catch (error) {
                console.error("Error:", error);
                alert("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. êµ¬ê¸€ ì‹œíŠ¸ ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }
        }

        function parseCSV(text) {
            // ê°„ë‹¨í•œ CSV íŒŒì„œ (ì¤„ë°”ê¿ˆìœ¼ë¡œ ë‚˜ëˆ„ê³ , ì½¤ë§ˆë¡œ ë‚˜ëˆ”)
            const rows = text.trim().split('\n').map(row => {
                // ë”°ì˜´í‘œ ì•ˆì˜ ì½¤ë§ˆ ì²˜ë¦¬ ë“±ì„ ìœ„í•œ ì •ê·œì‹
                const regex = /(?:^|,)(\"(?:[^\"]+|\"\")*\"|[^,]*)/g;
                let cells = [];
                let match;
                while (match = regex.exec(row)) {
                    let cell = match[1].replace(/^"|"$/g, '').replace(/""/g, '"');
                    cells.push(cell);
                }
                return cells;
            });
            return rows.slice(1); // í—¤ë”(ì²«ì¤„) ì œì™¸
        }

        function renderStocks(rows) {
            const list = document.getElementById('stockList');
            list.innerHTML = "";
            let totalStockValue = 0;

            rows.forEach(row => {
                // êµ¬ê¸€ì‹œíŠ¸ ìˆœì„œ: A(ì´ë¦„), B(ì½”ë“œ), C(ê°€ê²©), D(ìˆ˜ëŸ‰)
                const name = row[0];
                const priceStr = row[2] ? row[2].replace(/,/g, '') : "0"; // ì½¤ë§ˆ ì œê±°
                const countStr = row[3] ? row[3].replace(/,/g, '') : "0";

                const price = parseFloat(priceStr) || 0;
                const count = parseFloat(countStr) || 0;
                const total = price * count;

                totalStockValue += total;

                // HTML ìƒì„±
                const item = document.createElement('div');
                item.className = 'stock-item';
                item.innerHTML = `
                    <div>
                        <span class="stock-name">${name}</span>
                        <span class="stock-sub">${count.toLocaleString()}ì£¼</span>
                    </div>
                    <div class="stock-price" style="color:${price > 0 ? '#ff6b6b' : '#888'}">
                        ${price.toLocaleString()}ì›
                    </div>
                `;
                list.appendChild(item);
            });

            // ì´ ìì‚° ì—…ë°ì´íŠ¸
            const grandTotal = totalStockValue + FIXED_ASSETS;
            document.getElementById('totalMoney').innerText = "â‚© " + grandTotal.toLocaleString();

            // ì°¨íŠ¸ ì—…ë°ì´íŠ¸
            updateChart(totalStockValue, FIXED_ASSETS);
        }

        function renderNews(rows) {
            const list = document.getElementById('newsList');
            list.innerHTML = "";

            rows.forEach(row => {
                // êµ¬ê¸€ì‹œíŠ¸ ìˆœì„œ: A(íƒœê·¸), B(ì œëª©), C(AIë¶„ì„)
                if(row.length < 2) return;
                
                const tag = row[0];
                const title = row[1];
                const aiAnalysis = row[2];

                let tagClass = 'tag-stock';
                if (tag.includes('ë¶€ë™ì‚°')) tagClass = 'tag-estate';
                if (tag.includes('AI')) tagClass = 'tag-ai';

                const item = document.createElement('div');
                item.className = 'news-item';
                item.innerHTML = `
                    <span class="news-tag ${tagClass}">${tag}</span>
                    <div class="news-title">${title}</div>
                    <div class="ai-analysis">ğŸ’¡ ìˆ˜í˜„'s Tip: ${aiAnalysis}</div>
                `;
                list.appendChild(item);
            });
        }

        let assetChart = null;
        function updateChart(stockValue, fixedValue) {
            const ctx = document.getElementById('assetChart').getContext('2d');
            if (assetChart) assetChart.destroy();

            assetChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['ì£¼ì‹/ì½”ì¸', 'ë¶€ë™ì‚°/í˜„ê¸ˆ'],
                    datasets: [{
                        data: [stockValue, fixedValue],
                        backgroundColor: ['#ff6b6b', '#339af0'],
                        borderWidth: 0
                    }]
                },
                options: { 
                    responsive: true, 
                    maintainAspectRatio: false,
                    plugins: { 
                        legend: { position: 'bottom', labels: { color: 'white', padding: 20 } } 
                    } 
                }
            });
        }

        function openTab(tabName) {
            document.querySelectorAll('.content').forEach(el => el.style.display = 'none');
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById(tabName).style.display = 'block';
            event.target.classList.add('active');
        }

        // ì‹œì‘ ì‹œ ë°ì´í„° ë¶ˆëŸ¬ì˜¤ê¸°
        fetchData();
        // 60ì´ˆë§ˆë‹¤ ìë™ ê°±ì‹ 
        setInterval(fetchData, 60000); 

    </script>
</body>
</html>
